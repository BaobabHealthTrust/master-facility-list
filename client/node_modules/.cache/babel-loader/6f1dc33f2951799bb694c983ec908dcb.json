{"ast":null,"code":"import _objectSpread from \"/Users/caspater/Projects/Work/mhfr/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/caspater/Projects/Work/mhfr/src/scenes/Facility/UpdateFacility/index.tsx\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\"; // @ts-ignore\n\nimport { split } from \"lodash\";\nimport UpdateFacility from \"./UpdateFacility\";\nimport { fetchCurrentResources, fetchCurrentBasic, fetchCurrentServices, fetchCurrentUtilities } from \"../../../services/redux/actions/facilities\";\nimport { setActiveFacilityPage } from \"../../../services/redux/actions/ui\";\nimport { fetchOwners } from \"../../../services/redux/actions/dependancies\";\nimport { FacilityPages as pages } from \"../../../services/utils\";\nimport { library } from \"@fortawesome/fontawesome-svg-core\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { patchFacilityBasicDetails, patchFacilityContactDetails, patchFacilityResources, patchFacilityUtilities, deleteFacilityUtilities, patchFacilityServices, deleteFacilityServices } from \"../../../services/redux/actions/facilities\";\nimport { faHospital, faEnvelope, faBed, faWifi, faStethoscope } from \"@fortawesome/free-solid-svg-icons\";\nimport { getBasicDetails, getResources, getUtilitiesToDelete, getUtilities, getServicesToDelete, getServices, getCurrentServices } from \"./helpers\";\nimport { toast } from \"react-toastify\";\nimport Notification from \"../../../components/atoms/Notification\";\nimport { withRouter } from \"react-router-dom\";\nlibrary.add(faHospital, faEnvelope, faBed, faWifi, faStethoscope);\nexport class index extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      facilityId: null\n    };\n    this.facilitySubMenu = [{\n      link: pages.summary,\n      name: \"Facility Summary\",\n      icon: React.createElement(FontAwesomeIcon, {\n        icon: faHospital,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 57\n        },\n        __self: this\n      })\n    }, {\n      link: pages.contact,\n      name: \"Facility Contacts\",\n      icon: React.createElement(FontAwesomeIcon, {\n        icon: faEnvelope,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62\n        },\n        __self: this\n      })\n    }, {\n      link: pages.resources,\n      name: \"Facility Resources\",\n      icon: React.createElement(FontAwesomeIcon, {\n        icon: faBed,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67\n        },\n        __self: this\n      })\n    }, {\n      link: pages.utilities,\n      name: \"Facility Utilities\",\n      icon: React.createElement(FontAwesomeIcon, {\n        icon: faWifi,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72\n        },\n        __self: this\n      })\n    }, {\n      link: pages.services,\n      name: \"Facility Services\",\n      icon: React.createElement(FontAwesomeIcon, {\n        icon: faStethoscope,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      })\n    }];\n\n    this.onCancel = () => {\n      this.props.history.goBack();\n    };\n\n    this.handlePageChange = page => {\n      this.props.setActiveFacilityPage(page);\n      this.props.history.push(\"/facilities/\".concat(this.props.facility.id, \"/\").concat(page));\n    };\n\n    this.onSubmit = values => {\n      switch (this.props.facilityPage) {\n        case \"summary\":\n          this.onSubmitBasicDetails(values);\n          break;\n\n        case \"contact\":\n          this.onSubmitContactDetails(values);\n          break;\n\n        case \"resources\":\n          return this.onSubmitResourcesDetails(values);\n\n        case \"utilities\":\n          return this.onSubmitUtilityDetails(values);\n\n        case \"services\":\n          return this.onSubmitServiceDetails(values);\n      }\n    };\n\n    this.onSubmitBasicDetails = async values => {\n      let token = (await sessionStorage.getItem(\"token\")) || \"\";\n\n      let val = _objectSpread({}, values, {\n        published_date: values.publishedDate\n      });\n\n      if (token == \"\") return;\n      this.props.patchFacilityBasicDetails(getBasicDetails(val), Number(this.props.facility.id), token).then(() => {\n        this.onSuccess();\n      }).catch(() => {\n        this.onError();\n      });\n    };\n\n    this.onSubmitContactDetails = async values => {\n      let token = (await sessionStorage.getItem(\"token\")) || \"\";\n      let val = {\n        data: _objectSpread({}, values, {\n          client: 1,\n          updated_at: Date.now()\n        }),\n        id: Number(this.props.facility.id)\n      };\n      if (token == \"\") return;\n      return this.props.patchFacilityContactDetails(val, token).then(() => {\n        this.onSuccess();\n      }).catch(() => {\n        this.onError();\n      });\n    };\n\n    this.onSubmitResourcesDetails = async values => {\n      let token = (await sessionStorage.getItem(\"token\")) || \"\";\n      if (token == \"\") return;\n      let data = getResources(values, this.props.dependancies.resources.list, this.props.facility.id);\n      let error = false;\n\n      for (let val of data) {\n        await this.props.patchFacilityResources(val, token).catch(() => {\n          error = true;\n        });\n      }\n\n      if (error) {\n        this.onError();\n        return;\n      }\n\n      this.onSuccess();\n    };\n\n    this.onSubmitUtilityDetails = async values => {\n      let token = (await sessionStorage.getItem(\"token\")) || \"\";\n      if (token == \"\") return;\n      let utilitiesToDelete = getUtilitiesToDelete(values, this.props.facility.utilities);\n      let data = getUtilities(values, this.props.facility.id);\n      let error = false;\n\n      for (let utilityId of utilitiesToDelete) {\n        await this.props.deleteFacilityUtilities(utilityId, token).catch(() => {\n          error = true;\n        });\n      }\n\n      for (let val of data) {\n        await this.props.patchFacilityUtilities(val, token).catch(() => {\n          error = true;\n        });\n      }\n\n      if (error) {\n        this.onError();\n        return;\n      }\n\n      this.onSuccess();\n    };\n\n    this.onSubmitServiceDetails = async values => {\n      let token = (await sessionStorage.getItem(\"token\")) || \"\";\n      if (token == \"\") return;\n      let currentServices = getCurrentServices(this.props.facility.services);\n      let data = getServices(values, this.props.facility.id, currentServices);\n      let servicesToDelete = getServicesToDelete(data.map(val => val.service_id), currentServices);\n      let error = false;\n\n      for (let serviceId of servicesToDelete) {\n        await this.props.deleteFacilityServices(serviceId, token).catch(() => {\n          error = true;\n        });\n      }\n\n      for (let val of data) {\n        await this.props.patchFacilityServices(val, token).catch(() => {\n          error = true;\n        });\n      }\n\n      if (error) {\n        this.onError();\n        return;\n      }\n\n      this.onSuccess();\n    };\n\n    this.onError = () => {\n      toast.info(React.createElement(Notification, {\n        error: true,\n        message: \"Failed To Update Facility \".concat(this.props.facilityPage, \", Please Try Again\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }));\n    };\n\n    this.onSuccess = () => {\n      toast.info(React.createElement(Notification, {\n        message: \"Facility \".concat(this.props.facilityPage, \" Updated!!!\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275\n        },\n        __self: this\n      }));\n      this.props.history.push(\"/facilities/\".concat(this.props.facility.id, \"/\").concat(this.props.facilityPage));\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.dependancies.owners.list.length == 0) {\n      this.props.fetchOwners();\n    }\n\n    if (!this.props.facility.id) {\n      let location = split(window.location.pathname, \"/\");\n      let facilityId = location[location.length - 3];\n      let currentPage = location[location.length - 2];\n      this.props.setActiveFacilityPage(currentPage);\n      this.setState({\n        facilityId\n      });\n      this.props.fetchCurrentBasic(facilityId);\n      this.props.fetchCurrentResources(facilityId);\n      this.props.fetchCurrentServices(facilityId);\n      this.props.fetchCurrentUtilities(facilityId);\n    }\n  }\n\n  render() {\n    const _this$props = this.props,\n          facility = _this$props.facility,\n          loading = _this$props.loading;\n    return React.createElement(UpdateFacility, {\n      onCancel: this.onCancel,\n      loadingStates: loading,\n      sections: pages,\n      activePage: this.props.facilityPage,\n      onSubmit: this.onSubmit,\n      facility: facility,\n      dependancies: this.props.dependancies,\n      onChangePage: page => {\n        this.handlePageChange(page);\n      },\n      facilitySubMenu: this.facilitySubMenu,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288\n      },\n      __self: this\n    });\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    drawerOpen: state.ui.advancedSearchOpen,\n    facilityPage: state.ui.activeFacilityPage,\n    facility: state.facilities.current,\n    dependancies: state.dependancies,\n    loading: state.status\n  };\n};\n\nexport default withRouter(connect(mapStateToProps, {\n  fetchOwners,\n  fetchCurrentResources,\n  fetchCurrentBasic,\n  fetchCurrentServices,\n  fetchCurrentUtilities,\n  setActiveFacilityPage,\n  patchFacilityBasicDetails,\n  patchFacilityContactDetails,\n  patchFacilityResources,\n  patchFacilityUtilities,\n  deleteFacilityUtilities,\n  deleteFacilityServices,\n  patchFacilityServices\n})(index));","map":{"version":3,"sources":["/Users/caspater/Projects/Work/mhfr/src/scenes/Facility/UpdateFacility/index.tsx"],"names":["React","Component","connect","split","UpdateFacility","fetchCurrentResources","fetchCurrentBasic","fetchCurrentServices","fetchCurrentUtilities","setActiveFacilityPage","fetchOwners","FacilityPages","pages","library","FontAwesomeIcon","patchFacilityBasicDetails","patchFacilityContactDetails","patchFacilityResources","patchFacilityUtilities","deleteFacilityUtilities","patchFacilityServices","deleteFacilityServices","faHospital","faEnvelope","faBed","faWifi","faStethoscope","getBasicDetails","getResources","getUtilitiesToDelete","getUtilities","getServicesToDelete","getServices","getCurrentServices","toast","Notification","withRouter","add","index","state","facilityId","facilitySubMenu","link","summary","name","icon","contact","resources","utilities","services","onCancel","props","history","goBack","handlePageChange","page","push","facility","id","onSubmit","values","facilityPage","onSubmitBasicDetails","onSubmitContactDetails","onSubmitResourcesDetails","onSubmitUtilityDetails","onSubmitServiceDetails","token","sessionStorage","getItem","val","published_date","publishedDate","Number","then","onSuccess","catch","onError","data","client","updated_at","Date","now","dependancies","list","error","utilitiesToDelete","utilityId","currentServices","servicesToDelete","map","service_id","serviceId","info","componentDidMount","owners","length","location","window","pathname","currentPage","setState","render","loading","mapStateToProps","drawerOpen","ui","advancedSearchOpen","activeFacilityPage","facilities","current","status"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\n// @ts-ignore\nimport { split } from \"lodash\";\nimport UpdateFacility from \"./UpdateFacility\";\nimport {\n  fetchCurrentResources,\n  fetchCurrentBasic,\n  fetchCurrentServices,\n  fetchCurrentUtilities\n} from \"../../../services/redux/actions/facilities\";\nimport { setActiveFacilityPage } from \"../../../services/redux/actions/ui\";\nimport { fetchOwners } from \"../../../services/redux/actions/dependancies\";\nimport { FacilityPages as pages } from \"../../../services/utils\";\nimport { library } from \"@fortawesome/fontawesome-svg-core\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  patchFacilityBasicDetails,\n  patchFacilityContactDetails,\n  patchFacilityResources,\n  patchFacilityUtilities,\n  deleteFacilityUtilities,\n  patchFacilityServices,\n  deleteFacilityServices\n} from \"../../../services/redux/actions/facilities\";\nimport {\n  faHospital,\n  faEnvelope,\n  faBed,\n  faWifi,\n  faStethoscope\n} from \"@fortawesome/free-solid-svg-icons\";\nimport {\n  getBasicDetails,\n  getResources,\n  getUtilitiesToDelete,\n  getUtilities,\n  getServicesToDelete,\n  getServices,\n  getCurrentServices\n} from \"./helpers\";\nimport { toast } from \"react-toastify\";\nimport Notification from \"../../../components/atoms/Notification\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\n\nlibrary.add(faHospital, faEnvelope, faBed, faWifi, faStethoscope);\n\nexport class index extends Component<Props & RouteComponentProps<{}>> {\n  state = {\n    facilityId: null\n  };\n\n  facilitySubMenu = [\n    {\n      link: pages.summary,\n      name: \"Facility Summary\",\n      icon: <FontAwesomeIcon icon={faHospital} />\n    },\n    {\n      link: pages.contact,\n      name: \"Facility Contacts\",\n      icon: <FontAwesomeIcon icon={faEnvelope} />\n    },\n    {\n      link: pages.resources,\n      name: \"Facility Resources\",\n      icon: <FontAwesomeIcon icon={faBed} />\n    },\n    {\n      link: pages.utilities,\n      name: \"Facility Utilities\",\n      icon: <FontAwesomeIcon icon={faWifi} />\n    },\n    {\n      link: pages.services,\n      name: \"Facility Services\",\n      icon: <FontAwesomeIcon icon={faStethoscope} />\n    }\n  ];\n\n  onCancel = () => {\n    this.props.history.goBack();\n  };\n\n  handlePageChange = (page: any) => {\n    this.props.setActiveFacilityPage(page);\n    this.props.history.push(`/facilities/${this.props.facility.id}/${page}`);\n  };\n\n  componentDidMount() {\n    if (this.props.dependancies.owners.list.length == 0) {\n      this.props.fetchOwners();\n    }\n    if (!this.props.facility.id) {\n      let location = split(window.location.pathname, \"/\");\n      let facilityId = location[location.length - 3];\n      let currentPage = location[location.length - 2];\n\n      this.props.setActiveFacilityPage(currentPage);\n      this.setState({ facilityId });\n\n      this.props.fetchCurrentBasic(facilityId);\n      this.props.fetchCurrentResources(facilityId);\n      this.props.fetchCurrentServices(facilityId);\n      this.props.fetchCurrentUtilities(facilityId);\n    }\n  }\n\n  onSubmit = (values: any) => {\n    switch (this.props.facilityPage) {\n      case \"summary\":\n        this.onSubmitBasicDetails(values);\n        break;\n      case \"contact\":\n        this.onSubmitContactDetails(values);\n        break;\n      case \"resources\":\n        return this.onSubmitResourcesDetails(values);\n      case \"utilities\":\n        return this.onSubmitUtilityDetails(values);\n      case \"services\":\n        return this.onSubmitServiceDetails(values);\n    }\n  };\n\n  onSubmitBasicDetails = async (values: any) => {\n    let token = (await sessionStorage.getItem(\"token\")) || \"\";\n    let val = {\n      ...values,\n      published_date: values.publishedDate\n    };\n    if (token == \"\") return;\n\n    this.props\n      .patchFacilityBasicDetails(\n        getBasicDetails(val),\n        Number(this.props.facility.id),\n        token\n      )\n      .then(() => {\n        this.onSuccess();\n      })\n      .catch(() => {\n        this.onError();\n      });\n  };\n\n  onSubmitContactDetails = async (values: any) => {\n    let token = (await sessionStorage.getItem(\"token\")) || \"\";\n    let val = {\n      data: {\n        ...values,\n        client: 1,\n        updated_at: Date.now()\n      },\n      id: Number(this.props.facility.id)\n    };\n    if (token == \"\") return;\n\n    return this.props\n      .patchFacilityContactDetails(val, token)\n      .then(() => {\n        this.onSuccess();\n      })\n      .catch(() => {\n        this.onError();\n      });\n  };\n\n  onSubmitResourcesDetails = async (values: any) => {\n    let token = (await sessionStorage.getItem(\"token\")) || \"\";\n\n    if (token == \"\") return;\n\n    let data = getResources(\n      values,\n      this.props.dependancies.resources.list,\n      this.props.facility.id\n    );\n    let error = false;\n\n    for (let val of data) {\n      await this.props.patchFacilityResources(val, token).catch(() => {\n        error = true;\n      });\n    }\n\n    if (error) {\n      this.onError();\n      return;\n    }\n    this.onSuccess();\n  };\n\n  onSubmitUtilityDetails = async (values: any) => {\n    let token = (await sessionStorage.getItem(\"token\")) || \"\";\n\n    if (token == \"\") return;\n\n    let utilitiesToDelete = getUtilitiesToDelete(\n      values,\n      this.props.facility.utilities\n    );\n\n    let data = getUtilities(values, this.props.facility.id);\n\n    let error = false;\n\n    for (let utilityId of utilitiesToDelete) {\n      await this.props.deleteFacilityUtilities(utilityId, token).catch(() => {\n        error = true;\n      });\n    }\n\n    for (let val of data) {\n      await this.props.patchFacilityUtilities(val, token).catch(() => {\n        error = true;\n      });\n    }\n\n    if (error) {\n      this.onError();\n      return;\n    }\n    this.onSuccess();\n  };\n\n  onSubmitServiceDetails = async (values: any) => {\n    let token = (await sessionStorage.getItem(\"token\")) || \"\";\n\n    if (token == \"\") return;\n\n    let currentServices = getCurrentServices(this.props.facility.services);\n    let data = getServices(values, this.props.facility.id, currentServices);\n\n    let servicesToDelete = getServicesToDelete(\n      data.map(val => val.service_id),\n      currentServices\n    );\n\n    let error = false;\n\n    for (let serviceId of servicesToDelete) {\n      await this.props.deleteFacilityServices(serviceId, token).catch(() => {\n        error = true;\n      });\n    }\n\n    for (let val of data) {\n      await this.props.patchFacilityServices(val, token).catch(() => {\n        error = true;\n      });\n    }\n\n    if (error) {\n      this.onError();\n      return;\n    }\n    this.onSuccess();\n  };\n\n  onError = () => {\n    toast.info(\n      <Notification\n        error\n        message={`Failed To Update Facility ${\n          this.props.facilityPage\n        }, Please Try Again`}\n      />\n    );\n  };\n\n  onSuccess = () => {\n    toast.info(\n      <Notification\n        message={`Facility ${this.props.facilityPage} Updated!!!`}\n      />\n    );\n    this.props.history.push(\n      `/facilities/${this.props.facility.id}/${this.props.facilityPage}`\n    );\n  };\n\n  render() {\n    const { facility, loading } = this.props;\n\n    return (\n      <UpdateFacility\n        onCancel={this.onCancel}\n        loadingStates={loading}\n        sections={pages}\n        activePage={this.props.facilityPage}\n        onSubmit={this.onSubmit}\n        facility={facility}\n        dependancies={this.props.dependancies}\n        onChangePage={(page: any) => {\n          this.handlePageChange(page);\n        }}\n        facilitySubMenu={this.facilitySubMenu}\n      />\n    );\n  }\n}\n\nconst mapStateToProps = (state: any) => {\n  return {\n    drawerOpen: state.ui.advancedSearchOpen,\n    facilityPage: state.ui.activeFacilityPage,\n    facility: state.facilities.current,\n    dependancies: state.dependancies,\n    loading: state.status\n  };\n};\n\ntype Props = {\n  drawerOpen: boolean;\n  toggleFacilityFilter: Function;\n  facility: any;\n  dependancies: any;\n  facilityPage: string;\n  fetchOwners: Function;\n  fetchCurrentResources: Function;\n  fetchCurrentBasic: Function;\n  fetchCurrentServices: Function;\n  fetchCurrentUtilities: Function;\n  setActiveFacilityPage: Function;\n  patchFacilityBasicDetails: Function;\n  patchFacilityContactDetails: Function;\n  patchFacilityResources: Function;\n  patchFacilityUtilities: Function;\n  deleteFacilityUtilities: Function;\n  patchFacilityServices: Function;\n  deleteFacilityServices: Function;\n  history?: any;\n  loading: any;\n};\nexport default withRouter(\n  connect(\n    mapStateToProps,\n    {\n      fetchOwners,\n      fetchCurrentResources,\n      fetchCurrentBasic,\n      fetchCurrentServices,\n      fetchCurrentUtilities,\n      setActiveFacilityPage,\n      patchFacilityBasicDetails,\n      patchFacilityContactDetails,\n      patchFacilityResources,\n      patchFacilityUtilities,\n      deleteFacilityUtilities,\n      deleteFacilityServices,\n      patchFacilityServices\n    }\n  )(index)\n);\n"]},"metadata":{},"sourceType":"module"}